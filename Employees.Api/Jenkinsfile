node {
   stage('init') {
      checkout scm
   }
   stage('build') {
      sh '''
         mvn clean package
         cd target
         cp ../src/main/resources/web.config web.config
         cp todo-app-java-on-azure-1.0-SNAPSHOT.jar app.jar 
         zip todo.zip app.jar web.config
      '''
   }
   stage('restore') {   
   steps {
    sh '''
         dotnet restore Employees.Api/Employees.Api.sln
      '''
   }
  }
  stage('Tests') {   
  steps {
    sh '''
         dotnet test Employees.Api/Employees.Api.sln
      '''
   }
  }
  stage('Build') {   
  steps {
    sh '''
         dotnet build --configuration Release Employees.Api/Employees.Api.sln
      '''
   }
  }
  stage('Publish') {   
  steps {
       sh(script: "dotnet publish -c Release -o todo Employees.Api/Employees.Api.sln ", returnStdout: true)
   }
  }
   stage('deploy') {
      azureWebAppPublish azureCredentialsId: env.AZURE_CRED_ID,
      resourceGroup: env.RES_GROUP, appName: env.WEB_APP, filePath: "todo"
   }
}